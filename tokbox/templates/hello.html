<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>OpenTok Hello World</title>
    <script src="//static.opentok.com/webrtc/v2.2/js/TB.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript">
        var apiKey = '{{ apikey }}';
        var sessionId = '{{ session_id }}';
        var token = '{{ token }}';
    </script>
    <script src="static/js/helloworld.js"></script>

    <script type="text/javascript">
    $(document).ready(function(){
        $('#btn-chat').click(function(){
            sendsignal();
            $('#btn-input').val('');
            return false;
        });
        
        function sendsignal(){
            session.signal(
              {
                data: $('#btn-input').val(),
              },
              function(error) {
                if (error) {
                  console.log("signal error ("+ error.code+ "): " + error.message);
                } else {
                  console.log("signal sent.");
                }
              }
            );

        }

        session.on("signal", function(event) {
            $('#messages').append("<div class='row'> <div id='sendermessages'></div></div> ");
            $('#sendermessages').text(event.data);

            console.log("Signal sent from connection " + event.data);
            // Process the event.data property, if there is any data.
        });
    });

        
    </script>
</head>
<body>
    <h2>Hello, World!</h2>

    <div id="publisher"></div>

    <div id="subscribers"></div>

    <div class="container">
    <div class="row">
        <div class="col-md-12 chatbox">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <span class="glyphicon glyphicon-comment"></span> Chatroom
                </div>
                <div class="panel-body">
                  <div id="messages">
                    <div id="msg">
                    </div>
                  </div>
                  
                </div>
                <div class="panel-footer">
                  <form id="form-msgbox" name="form-msgbox">
                    <div class="input-group">
                        <input id="btn-input" type="text" class="form-control" placeholder="Type your message here..." autocomplete="off"/>
                        <span class="input-group-btn">
                            <button class="btn btn-primary" id="btn-chat"  type="submit">Send</button>
                        </span>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
